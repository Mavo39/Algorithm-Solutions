# Walker は出版社で文章チェックの仕事中。() や {}、[] で括られている文章をチェックしているが、正しく使われているか見なければいけません。文字列 parentheses が与えられるので、それが有効かどうか判定する、isParenthesesValid という関数を作成する問題

## 与えられる文字列が有効となる条件
- 左カッコが同じ種類の右カッコで閉じられてる
- 左カッコが右カッコによって正しい順で閉じられている

## ヒント
>閉じる側の括弧をキーとして、正しい括弧のペアでハッシュマップを作成します。スタックを使って正しいペアの時スタックからpopします。


## 関数の入出力例
入力のデータ型： `string parentheses`  
出力のデータ型： `bool`  


## テストケース
1. `isParenthesesValid("{}") --> true`  
2. `isParenthesesValid("[{}]") --> true`  
3. `isParenthesesValid("[{(]") --> false`  
4. `isParenthesesValid("(){}[]") --> true`  
5. `isParenthesesValid("((()(())))") --> true`  
6. `isParenthesesValid("[{(}])") --> false`  
7. `isParenthesesValid("]][}{({()){}(") --> false`  
8. `isParenthesesValid("{(([])[])[]}[]") --> true`  
9. `isParenthesesValid("{(([])[])[]]}") --> false`  
10. `isParenthesesValid("{{[[(())]]}}") --> true`  


## 【思考プロセス】
#### 【ゴール】  
1. 括弧が正しい順序・ペアで使用されているかをチェックする isParenthesesValid という関数を実装すること  
2. テストケースをクリアすること

#### 【目的】
括弧が文字列 parentheses 内で正しく使用されていること  
※「正しく」: 括弧が入れ子の構造になっていること  

#### 【必要タスク】
1. Stackクラスの再利用 
※ コードは[Common](../Common/php)のものを再利用しました  

2. isParenthesesValid 関数を実装
- 文字列の不正チェック
- Stackインスタンスの作成
- ハッシュマップの作成（キー: 閉じ括弧 / 値: 開き括弧）
- 文字列のループ処理
- スタックにプッシュするとき: ペアにならないとき
(1) スタックが空のとき  
(2) スタックの最上部にある要素と比較対象の文字（ハッシュマップ使用）が一致しないとき  
- スタックからポップするとき: 正しいペアになったとき
 
#### 【検証】  
- 仮説に沿って実装した結果、エラーが発生
- Stackクラスを再利用していたが、スタックを配列を使って実装する方針に転換した
- その結果、期待通りの出力結果を得ることができた

## 【悩んだ箇所】
- ヒントにおいて、なぜ閉じ括弧がキーになるのか
→ ペアであることを確認するには、「この文字のときはこの文字」といった 1対1の関係（イコール）を作る必要がある  
→ 閉じ括弧をハッシュマップのキーにすることで、「今の閉じ括弧に対応する開き括弧はこれ」とすぐに取り出せる  
→ これにより、ハッシュマップにアクセスしたときの対応する開き括弧と、スタックのトップにある文字が一致するかを比較できるようになる  
- スタックが適しているとされる理由
→ 開き括弧は対応する閉じ括弧が現れるまで保持しておく必要がある  
→ ただし、一度使い終えた開き括弧は再び使うことがないので、LIFOのスタック構造が適していると考えられる  
→ また、すべての括弧が正しくペアになっていれば、最終的にスタックが空になる  
→ これを使って構文が正しいかどうかを判定できる  
- 下記`【直面したエラーと解決策】`のエラー①の解消法
→ 自力でなんとか解決しようとしたが、3時間もかけていることに気づき、やむなくAIからヒントをもらい解消した

## 【直面したエラーと解決策】
**エラー①**
【エラーメッセージ】
```sh
PHP Warning:  Undefined array key "{" in ~/Stack/isParenthesesValid/php/src/isParenthesesValid.php on line 16
```
【内容】配列のキーとして`{`が定義されていない  
【原因】配列にキーが存在するかどうかのチェックがされていなかったこと  
【解決プロセス】
1. Stackクラスを使用せず配列を使用すればできるかもしれないと考える
2. `1.`の結果は同じだった
3. 自動テストのロジックが原因かもしれないと考える
4. 手動テストに変更して出力の確認 → 結果は同じ
5. 模索するも、配列のキーがないことをどう証明すればいいか検討がつかず
6. claudeに質問し、配列のキーの存在確認をすればいいとわかる  
【解決策】`array_key_exist()`を使って、配列のキーの存在を確認して条件分岐する

## 【気づき】
- 悩んでいたとき、なぜ配列のキーが定義されていないのかが分からなかった
→ 閉じ括弧は定義していたが、開き括弧を定義していないことが原因だとAIアドバイスによってわかった
- 自分はこれが正しいのでは？と思って書いているので、無意識に自分のコードは正しいという目で見てしまい、盲目的になっている可能性があると感じた
→ claudeのアドバイスにより、`array_key_exist()`をつかって条件分岐すれば済むところを、必要以上に時間をかけてしまった  
→ 後から見れば「これだけ」ということでも、そのときは近視眼的になっているのだと反省  
→ いかに、フラットな目で見れるかがカギだということを肝に命じること  
- スタックを使う意味を自力で仮説を立てて使った点はよかった
- 問題文の解釈はずれていなかった

## 【フィードバック・改善点】
- `array_key_exist()`を使った条件分岐
これにより、配列にキーが存在しないときと存在するときで処理を分けることができる